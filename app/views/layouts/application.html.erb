<!-- http://semantic-ui.com/elements/container.html#/examples -->
<!DOCTYPE html>
<html>
<head>
  <title><%= yield(:title) %></title>
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => false %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => false %>
  <%= csrf_meta_tags %>
</head>
<body>
<% if request.path != new_user_session_path %>
  <div class="ui attached stackable menu">
    <div class="ui container">
      <a class="item" href="/">
        <i class="home icon"></i> 首页
      </a>
      <%= render partial: 'layouts/application_menu_notifies' %>
      <div class="ui simple dropdown item">
        更多操作
        <i class="dropdown icon"></i>
        <div class="menu">
          <a class="item"><i class="edit icon"></i> 个人资料</a>
          <a class="item"><i class="settings icon"></i> 系统设置</a>
          <% if user_signed_in? %>
            <%= link_to(destroy_user_session_path, :method => :delete, class: 'item') do %>
            <i class="sign out icon"></i> <span style="color: red;margin-right: 5px;"><%= current_user.name %></span>退出登录
            <% end %>
          <% else %>
            <%= link_to(new_user_session_path, class: 'item') do %>
            <i class="sign in icon"></i> 登录
            <% end %>
          <% end %>
        </div>
      </div>
      <div class="right item">
        <div class="ui search">
          <div class="ui left icon input">
            <input class="prompt" type="text" placeholder="Search ERP">
            <i class="search icon"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  <%= render partial: 'layouts/breadcrumb' %>
<% end %>
<%= yield %>
<script type="text/javascript">
  $('.ui.search')
    .search({
      type: 'category',
      minCharacters: 1,
      apiSettings: {
        onResponse: function(githubResponse) {
          var
            response = {
              results: {}
            };
          // translate GitHub API response to work with search
          $.each(githubResponse.items, function(index, item) {
            var
              business = item.business || '其它',
              maxResults = 8;
            if (index >= maxResults) {
              return false;
            }
            // create new business category
            if (response.results[business] === undefined) {
              response.results[business] = {
                name: business,
                results: []
              };
            }
            // add result to category
            response.results[business].results.push({
              title: item.name,
              description: item.description,
              url: item.html_url
            });
          });
          return response;
        },
        url: '/service/search?q={query}'
      }
    });
</script>
</body>
</html>